/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  6
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/

libs            ("libutilityFunctionObjects.so");

type            coded;

writeControl    writeTime;

name            angularMomentum;

codeWrite
#{
    const dimensionedScalar rhoInf(dimDensity, 1.205); // set using projectDict

    const volVectorField& U = mesh().lookupObject<volVectorField>("U");

    volVectorField L
    (
        IOobject("L", mesh().time().timeName(), mesh()),
        mesh(),
        dimensionedVector(dimLength*dimVelocity*dimMass, Zero),
        calculatedFvPatchField<scalar>::typeName
    );

    Info<< "\nCalculate angular momentum field" << endl;
    L.ref() =
    (
        mesh().C() ^ U*mesh().V()*rhoInf
    );
    L.correctBoundaryConditions();

    // Suppress Z component of the angular momentum
    L.replace(vector::Z, 0.0);

    L.write();
#};

// ************************************************************************* //